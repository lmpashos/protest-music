xquery version "3.0";
let $songs := collection('/db/course/protest')/*
let $nonprotest :=
    for $song in $songs
    where not($song//protest = "true")
    return $song
for $song in $nonprotest
let $title := $song//title
let $nounPhrases := $song//nounPhrase
let $nounPhrasesCount := count($nounPhrases)
let $withAdj := 
    for $nounPhrase in $nounPhrases
    where $nounPhrase//adjective
    return $nounPhrase
let $withAdjCount := count($withAdj)
let $percent := round(($withAdjCount div $nounPhrasesCount * 100) * 100) div 100
return $title || ": percent of noun phrases that contain an adjective: " || $percent || "%"