xquery version "3.0";
let $songs := collection('/db/course/protest')/*
for $song in $songs
let $title := $song//title
let $nounPhrases := $song//nounPhrase
let $nounPhrasesCount := count($nounPhrases)
let $negated := 
    for $nounPhrase in $nounPhrases
    where $nounPhrase[@neg = "true"]
    return $nounPhrase
let $negatedCount := count($negated)
let $percent := round(($negatedCount div $nounPhrasesCount * 100) * 100) div 100
return $title || ": percent of noun phrases that contain negation: " || $percent || "%"