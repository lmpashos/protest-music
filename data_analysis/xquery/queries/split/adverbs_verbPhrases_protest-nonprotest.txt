xquery version "3.0";
let $songs := collection('/db/course/protest')/*

let $protest :=
    for $song in $songs
    where $song//protest = "true"
    return $song
let $nonprotest :=
    for $song in $songs
    where not($song//protest = "true")
    return $song
    
let $protestVerbPhrases := 
    for $song in $protest
    return $song//verbPhrase
let $nonprotestVerbPhrases :=
    for $song in $nonprotest
    return $song//verbPhrase
    
let $countProtest := count($protestVerbPhrases)
let $countNonprotest := count($nonprotestVerbPhrases)

let $protestWithAdverb :=
    for $verbPhrase in $protestVerbPhrases
    where $verbPhrase//adverb
    return $verbPhrase
let $nonprotestWithAdverb:=
    for $verbPhrase in $nonprotestVerbPhrases
    where $verbPhrase//adverb
    return $verbPhrase
    
let $countProtestWithAdverb := count($protestWithAdverb)
let $countNonprotestWithAdverb := count($nonprotestWithAdverb)

let $percentProtest := round(($countProtestWithAdverb div $countProtest * 100) * 100) div 100
let $percentNonprotest := round(($countNonprotestWithAdverb div $countNonprotest * 100) * 100) div 100

return(
    "Percent of verb phrases that contain an adverb in protest songs: " || $percentProtest || "%",
    "Percent of verb phrases that contain an adverb in nonprotest songs: " || $percentNonprotest || "%"
)