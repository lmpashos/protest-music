xquery version "3.0";
let $songs := collection('/db/course/protest')/*
for $song in $songs
let $title := $song//title
let $verbPhrases := $song//verbPhrase
let $verbPhrasesCount := count($verbPhrases)
let $negated := 
    for $verbPhrase in $verbPhrases
    where $verbPhrase[@neg = "true"]
    return $verbPhrase
let $negatedCount := count($negated)
let $percent := round(($negatedCount div $verbPhrasesCount * 100) * 100) div 100
return $title || ": percent of verb phrases that contain negation: " || $percent || "%"